<!DOCTYPE html>
<html lang="cs">
	<head>
		<title> Radio Online </title>
		<meta name="author" content="Miraficus">
		<meta name="theme-color" media="(prefers-color-scheme: light)" content="#add8e6">
		<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#444444">
		<meta charset="utf-8">
		<link rel="icon" id="icon" href="assets/favicon_white_black_border" sizes="any" type="image/svg+xml" media="(prefers-color-scheme:no-preference)" />		
		<link rel="icon" id="icon" href="assets/favicon_black.svg" sizes="any" type="image/svg+xml" media="(prefers-color-scheme:light)" />
		<link rel="icon" id="icon" href="assets/favicon_white.svg" sizes="any" type="image/svg+xml" media="(prefers-color-scheme:dark)" />
		<link rel="stylesheet" type="text/css" href="css/base.css">
		<link rel="manifest" href="manifest.json" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="application-name" content="Radio Online" />
		<meta name="apple-mobile-web-app-title" content="Radio Online" />
		<meta name="msapplication-starturl" content="/index.html" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, viewport-fit=cover">
		<script src="https://code.jquery.com/jquery-3.7.1.js" type="text/javascript"></script>
		<script type="text/javascript">
			if (window.document.documentMode) {
				  alert("Please use better Chromium or Firefox based web browser!\nProsím použijte webový prohližeč založený na Chromiu nebo Firefox!");
			}

		</script>
		<script type="text/javascript">
			
			// 21.6.2022 Was this Thing made!
			// --- Get the root element ---
			var rootvar = document.querySelector(':root');

			// --- Change theme ---

			function themechange() {
				var theme = document.getElementById("themechoice").value;
				console.log(theme);

				switch(theme) {
				case 'light':
					console.log("Theme Light");
					rootvar.style.setProperty('--main-bg-color', 'white');
					rootvar.style.setProperty('--sec-bg-color', 'white');
					rootvar.style.setProperty('--ter-bg-color', 'white');
					rootvar.style.setProperty('--accent-bg-color', 'lightblue');
					rootvar.style.setProperty('--hover-bg-color', '#7bb9cd');
					rootvar.style.setProperty('--main-text-color', 'black');
					rootvar.style.setProperty('--sec-text-color', 'black');
					rootvar.style.setProperty('--shadow-color', '#555555');
					rootvar.style.setProperty('--accent-border-color', 'transparent');
					rootvar.style.setProperty('color-scheme', 'light');
				break;
				case 'dark':
					console.log("Theme Dark");
					rootvar.style.setProperty('--main-bg-color', '#222222');
					rootvar.style.setProperty('--sec-bg-color', '#222222');
					rootvar.style.setProperty('--ter-bg-color', '#222222');
					rootvar.style.setProperty('--accent-bg-color', '#444444');
					rootvar.style.setProperty('--hover-bg-color', '#1c1c1c');
					rootvar.style.setProperty('--main-text-color', 'white');
					rootvar.style.setProperty('--sec-text-color', 'white');
					rootvar.style.setProperty('--shadow-color', 'black');
					rootvar.style.setProperty('--accent-border-color', 'transparent');
					rootvar.style.setProperty('color-scheme', 'dark');
				break;
				case 'black':
					console.log("Theme Black");
					rootvar.style.setProperty('--main-bg-color', 'black');
					rootvar.style.setProperty('--sec-bg-color', 'black');
					rootvar.style.setProperty('--ter-bg-color', 'black');
					rootvar.style.setProperty('--accent-bg-color', '#222222');
					rootvar.style.setProperty('--hover-bg-color', '#444444');
					rootvar.style.setProperty('--main-text-color', 'white');
					rootvar.style.setProperty('--sec-text-color', 'white');
					rootvar.style.setProperty('--shadow-color', 'black');
					rootvar.style.setProperty('--accent-border-color', '#888888');
					rootvar.style.setProperty('color-scheme', 'dark');
				break;
				case 'blue':
					console.log("Theme Blue");
					rootvar.style.setProperty('--main-bg-color', '#0A1929');
					rootvar.style.setProperty('--sec-bg-color', '#173A5E');
					rootvar.style.setProperty('--ter-bg-color', '#173A5E');
					rootvar.style.setProperty('--accent-bg-color', '#5090D3');
					rootvar.style.setProperty('--hover-bg-color', '#66B2FF');
					rootvar.style.setProperty('--main-text-color', 'white');
					rootvar.style.setProperty('--sec-text-color', 'white');
					rootvar.style.setProperty('--shadow-color', 'black');
					rootvar.style.setProperty('--accent-border-color', 'transparent');
					rootvar.style.setProperty('color-scheme', 'light');
				break;
				default:
					console.log("No Theme");
				break;
				}
			}

		</script>
	</head>
	<body>
		<div class="header">
			<a onclick="alert('Verze 1.4');" id="left">Radio</a>
			<select name="themechoice" id="themechoice" onchange="themechange();">
				<option value="light" selected>Světlý vzhled</option>
			 	<option value="dark">Tmavý vzhled</option>
				<option value="black">Černý vzhled</option>
				<option value="blue">Modrý vzhled</option>
			</select>
			<a href="https://github.com/miraficus/RadioPlayer" id="right" target="_blank">Zdrojový kód</a>
		</div>

		<div class="player" id="player">
			<p id="player-name">Krokodýl</p>
			<audio controls preload="none" id="audio">
				<source id="player-src" src="https://icecast4.play.cz/krokodyl128.mp3" type="audio/mpeg">
				The audio element is not supported.\n Váš prohlížeč nepodporuje audio přehrávač.
			</audio>
			<input type="checkbox" id="autoplay" size="10">
			<label for="autoplay">Autoplay</label>
		</div>

		<div class="wrapper">


		</div>
		<div class="footer">
			<p id="year"></p>
			<script type="text/javascript">document.getElementById("year").innerHTML = "© "+new Date().getFullYear();</script>
		</div>
		<script type="text/javascript">
		
			// --- Switch audio sources ---
			
			function checkautoplay() {
				if (document.getElementById('autoplay').checked) {
	            	console.log("Autoplay Checked");
	            	var playersource = document.getElementById("audio").play();
		        } else {
		            console.log("Autoplay Unchecked");
		        }
			}

			document.addEventListener('DOMContentLoaded', function() {
				// Theme select
				const themeSelect = document.getElementById('themechoice');
				// Restore saved theme from localStorage
				const savedTheme = localStorage.getItem('selectedTheme');
				if (savedTheme) {
					themeSelect.value = savedTheme;
					themechange(); // Apply theme on load
				}
				// Save the theme to localStorage when changed
				themeSelect.addEventListener('change', function() {
					localStorage.setItem('selectedTheme', themeSelect.value);
				});

				// Autoplay checkbox
				const autoplayCheckbox = document.getElementById('autoplay');
				const savedAutoplay = localStorage.getItem('autoplayChecked');
				if (savedAutoplay === "true") {
					autoplayCheckbox.checked = true;
				} else {
					autoplayCheckbox.checked = false;
				}
				autoplayCheckbox.addEventListener('change', function() {
					localStorage.setItem('autoplayChecked', autoplayCheckbox.checked);
				});

				// Render station icons (grouped by language)
				renderStations();

				// Restore last used station (if any)
				const savedStation = localStorage.getItem('lastStation');
				if (savedStation && stations[savedStation]) {
					// changeStation will update the UI and call checkautoplay()
					changeStation(savedStation);
					// If autoplay was saved, ensure play is attempted (changeStation already calls checkautoplay)
				}
			});

			const stations = {
				beat:        { name: "Radio Beat", url: "https://ice6.abradio.cz/beat128.aac", img: "assets/covers/Czech/Beat.svg", lang: "Česky" },
				casrock:     { name: "Radio Čas Rock", url: "https://icecast7.play.cz/casrock128.mp3", img: "assets/covers/Czech/CasRock.png", lang: "Česky" },
				country:     { name: "Country Radio", url: "https://n10a-eu.rcs.revma.com/h7rwanvb938uv", img: "assets/covers/Czech/CountryRadio.png", lang: "Česky" },
				evropa:      { name: "Radio Evropa2", url: "https://ice.actve.net/fm-evropa2-128", img: "assets/covers/Czech/Evropa2.svg", lang: "Česky" },
				fajnradio:   { name: "Fajn Radio", url: "https://playerservices.streamtheworld.com/api/livestream-redirect/FAJN_RADIO.aac", img: "assets/covers/Czech/Fajnradio.svg", lang: "Česky" },
				free:        { name: "Free Radio", url: "https://icecast8.play.cz/freeradio128.mp3", img: "assets/covers/Czech/Freeradio.svg", lang: "Česky" },
				frekvence:   { name: "Radio Frekvence 1", url: "https://25703.live.streamtheworld.com/FREKVENCE1AAC.aac", img: "assets/covers/Czech/Frekvence1.svg", lang: "Česky" },
				hey:         { name: "Radio Hey", url: "https://icecast3.play.cz/hey-radio128.mp3", img: "assets/covers/Czech/RadioHey.svg", lang: "Česky" },
				city:        { name: "Hitradio City", url: "https://playerservices.streamtheworld.com/api/livestream-redirect/HITRADIO_CITY_PRAHA.aac", img: "assets/covers/Czech/HitradioCity.svg", lang: "Česky" },
				impuls:      { name: "Radio Impuls", url: "https://icecast1.play.cz/impuls128.mp3", img: "assets/covers/Czech/Impuls.svg", lang: "Česky" },
				kiss:        { name: "Radio KissHady", url: "https://ice5.abradio.cz/kiss128.mp3", img: "assets/covers/Czech/Kiss.svg", lang: "Česky" },
				krokodyl:    { name: "Radio Krokodýl", url: "https://icecast4.play.cz/krokodyl128.mp3", img: "assets/covers/Czech/Krokodyl.svg", lang: "Česky" },
				metalheart:  { name: "Metal Heart Radio", url: "http://cz.radio-streamhosting.com:8000/metalheartradio128mp3", img: "assets/covers/Czech/MetalHeart.png", lang: "Česky" },
				oldies:      { name: "Oldies Radio", url: "https://ice2.abradio.cz/oldiesradio128.aac", img: "assets/covers/Czech/Oldies.svg", lang: "Česky" },
				rockradio:   { name: "Rockovy Radio", url: "https://playerservices.streamtheworld.com/api/livestream-redirect/ROCK_RADIO.aac", img: "assets/covers/Czech/RockRadio.svg", lang: "Česky" },
				rockradioalt:{ name: "Rockovy Radio - Alternative", url: "https://ice2.abradio.cz/znamkapunku128.aac", img: "assets/covers/Czech/RockRadioAlternative.svg", lang: "Česky" },
				heavyrockradio: { name: "Rockovy Radio - Hard & Heavy", url: "https://ice2.abradio.cz/metalomanie128.aac", img: "assets/covers/Czech/RockRadioHardAHeavy.svg", lang: "Česky" },
				rockzone:   { name: "Rock Zone", url: "https://stream.sepia.sk:8000/rockzone128.mp3", img: "assets/covers/Czech/RockZone.svg", lang: "Česky" },
				simulator:   { name: "Simulator Radio", url: "https://simulatorradio.stream/stream", img: "assets/covers/English/SimulatorRadio.png", lang: "Anglicky" },
				simrock:     { name: "Simulator Radio Rock", url: "https://simulatorradio.stream/rock.mp3", img: "assets/covers/English/SimulatorRadio2.png", lang: "Anglicky" },
				simdance:    { name: "Simulator Radio Dance", url: "https://simulatorradio.stream/dance.mp3", img: "assets/covers/English/SimulatorRadio3.png", lang: "Anglicky" },
				eska:        { name: "Eska Wroclaw (Vratislav)", url: "https://ic2.smcdn.pl/2180-1.mp3", img: "assets/covers/Polish/Eska.png", lang: "Polsky" },
				kronehit:    { name: "Kronehit", url: "https://secureonair.krone.at/kronehit64.aac", img: "assets/covers/Austrian/Kronehit.png", lang: "Německy" }
			};

			function renderStations() {
				const wrapper = document.querySelector('.wrapper');
				wrapper.innerHTML = ''; // Clear existing

				// Group stations by language
				const groups = {};
				Object.entries(stations).forEach(([key, station]) => {
					const lang = station.lang || 'Jiné';
					if (!groups[lang]) groups[lang] = [];
					groups[lang].push({ key, ...station });
				});

				// Order languages: prefer Česky first, Anglicky second, then rest alphabetically
				const preferredOrder = ['Česky', 'Anglicky'];
				const otherLangs = Object.keys(groups).filter(l => !preferredOrder.includes(l)).sort((a, b) => a.localeCompare(b, 'cs', { sensitivity: 'base' }));
				const orderedLangs = [
					...preferredOrder.filter(l => groups[l]),
					...otherLangs
				];

				orderedLangs.forEach(lang => {
					// Language header
					const header = document.createElement('h2');
					header.textContent = lang;
					header.className = 'language-header';
					wrapper.appendChild(header);

					// Sort stations alphabetically by name (use Czech locale for proper diacritics sort)
					const items = groups[lang].sort((a, b) => a.name.localeCompare(b.name, 'cs', { sensitivity: 'base' }));

					const groupDiv = document.createElement('div');
					groupDiv.className = 'language-group';

					items.forEach(station => {
						const div = document.createElement('div');
						div.className = 'radio-icon';
						div.onclick = () => changeStation(station.key);

						const img = document.createElement('img');
						img.src = station.img.startsWith('http') ? station.img : `https://raw.githubusercontent.com/miraficus/RadioPlayer/main/docs/${station.img}`;
						img.alt = station.name;
						img.onclick = () => changeStation(station.key);

						const a = document.createElement('a');
						a.textContent = station.name;
						a.onclick = () => changeStation(station.key);

						div.appendChild(img);
						div.appendChild(a);
						groupDiv.appendChild(div);
					});

					wrapper.appendChild(groupDiv);
				});
			}

			function changeStation(stationKey) {
				const station = stations[stationKey];
				if (!station) return;
				const timenow = new Date();
				document.getElementById("player-name").innerHTML = station.name;
				document.getElementById("player-src").src = station.url + "?time=" + timenow.getTime();
				document.getElementById("audio").load();

				// Save the last used station so it can be restored on reload
				try {
					localStorage.setItem('lastStation', stationKey);
				} catch (e) {
					console.warn("Could not save lastStation to localStorage:", e);
				}

				checkautoplay();
			}

		</script>
	</body>
</html>